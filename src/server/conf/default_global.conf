# modo de execução (server/agent)
execution_mode="server"
verbosity="verbose"

# Caminhos para diretórios e arquivos utilizados no processo de deploy.

work_dir="$install_dir/tmp"
bak_dir="$install_dir/bak"
history_dir="$install_dir/log"
app_history_dir_tree="$install_dir/log/sistemas"
cgi_dir="$install_dir/cgi"
css_dir="$install_dir/css"
repo_dir="$install_dir/repo"
lock_dir="/var/lock/deploy-utils"
app_conf_dir="$install_dir/conf/app"
service_log_file="service.log"

# Opções de deploy padrão

ambientes="desenvolvimento teste homologacao sustentacao producao"
modo_padrao="p"                                                             # p/d (p - preservar arquivos obsoletos / d - deletar arquivos obsoletos)

nfs_auth='sys'                                                              # nfs_auth: none, sys, krb5, krb5i, krb5p
nfs_opts="sec=$nfs_auth"

cifs_auth='ntlm'                                                            # cifs_auth: none, krb5, krb5i, ntlm, ntlmi, ntlmv2, ntlmv2i, ntlmssp, ntlmsspi
cifs_credentials="/root/.deploy_user_ad"
cifs_opts="credentials=$cifs_credentials,sec=$cifs_auth"

rsync_opts="--recursive --checksum --inplace --safe-links"
end_msg="FIM"

max_running=10
lock_timeout=30000                                                          # em milisegundos

# Expurgo de logs

app_log_max='1000'
global_history_size='30000'
service_log_size='30000'

# Daemon

service_init_script='/etc/init.d/deploy_service'
deploy_queue="$work_dir/deploy_queue"

# Web

ssl_enable='false'
ssl_crt_path=''
ssl_key_path=''

set_apache_namevirtualhost_directive='true'
set_apache_listen_directive='false'

apache_daemon='httpd'                                                       # utilizar 'apache2' no debian e derivados.
apache_user='apache'
apache_group='apache'
apache_confd_dir="/etc/$apache_daemon/conf.d"
apache_log_dir="/var/log/$apache_daemon"
apache_init_script="/etc/init.d/$apache_daemon"
apache_vhost_filename='deploy_utils.conf'
apache_vhost_logname='deploy_utils'
apache_vhost_name='*'
apache_vhost_port='80'
apache_servername="$HOSTNAME"
apache_cgi_alias='/deploy_utils'
apache_css_alias="$apache_cgi_alias/css"
apache_log_alias="$apache_cgi_alias/logs"

web_users_file="$install_dir/conf/passwords"
web_groups_file="$install_dir/conf/groups"
web_permissions_file="$install_dir/conf/permissions"
web_admin_user="admin"                                                   # a conta deve ser desabilitada após o primeiro acesso.
web_admin_password="_ADMIN_"

cgi_timeout='300'
cgi_table_size='20'
cgi_list_pages='index search app_params signup deploy_pages users groups'
cgi_public_pages='index search signup'
cgi_private_pages='deploy_pages'
cgi_admin_pages='users groups app_params'
cgi_index_title='Histórico de Deploy'
cgi_search_title='Busca Avançada'
cgi_app_params_title='Parâmetros de Aplicação'
cgi_deploy_pages_title='Deploy de Aplicação'
cgi_users_title='Administração de Usuários'
cgi_groups_title='Administração de Grupos'
cgi_signup_title='Sign Up'

# Estrutura da tabela de permissões:

col_subject_type='[subject_type]'
col_subject_name='[subject_name]'
col_resource_type='[resource_type]'
col_resource_name='[resource_name]'
col_permission='[permission]'

# Expressões de validação utilizadas na interface Web

regex_user='[a-zA-Z0-9_\-\.]+'
regex_group='[a-zA-Z0-9_\-\.]+'
regex_password='[a-zA-Z0-9_\-\+\.\!=@,/%]+'

regex_subject_type="user|group"
regex_subject_name="[a-zA-Z0-9_\-\.]+"
regex_resource_type="app|ambiente"
regex_resource_name="[a-zA-Z0-9_\-\.]+"
regex_permission="read|write"

# Expressões de validação de diretórios utilizados no processo de deploy

regex_tmp_dir="/opt$regex_dir"
regex_bak_dir="/opt$regex_dir"
regex_cgi_dir="/opt$regex_dir"
regex_history_dir="/opt$regex_dir|/mnt$regex_dir"
regex_repo_dir="/opt$regex_dir|/mnt$regex_dir"
regex_lock_dir="/var$regex_dir"

# Expressões de validação de parâmetros das aplicações

regex_hash='([0-9a-f]){7}[0-9a-f]*'
regex_tag='[a-zA-Z0-9_\-\.]+'
regex_branch='[^[:cntrl:][:space:]\\]+'

regex_repo='git@git\.anatel\.gov\.br\:[a-z]+([-_])?[a-z]+/[a-z]+([-_])?[a-z]+\.git|http://git\.anatel\.gov\.br/[a-z]+([-_])?[a-z]+/[a-z]+([-_])?[a-z]+\.git'
regex_rev="$regex_hash|$regex_tag|$regex_branch|auto|rollback"
regex_raiz='/?([^/ \\]+/?)+|/'
regex_mount_type='cifs|nfs'
regex_share='/?([^/ \\]+/?)+'

regex_branch_desenvolvimento='[a-zA-Z_]+'
regex_branch_teste='[a-zA-Z_]+'
regex_branch_homologacao='[a-zA-Z_]+'
regex_branch_sustentacao='[a-zA-Z_]+'
regex_branch_producao='master|stable|producao'

regex_revisao_desenvolvimento='tag|commit'
regex_revisao_teste='tag|commit'
regex_revisao_homologacao='tag'
regex_revisao_sustentacao='tag'
regex_revisao_producao='tag'

regex_modo_desenvolvimento='[pd]'
regex_modo_teste='[pd]'
regex_modo_homologacao='[pd]'
regex_modo_sustentacao='[pd]'
regex_modo_producao='[pd]'

regex_auto_desenvolvimento='[01]'
regex_auto_teste='[01]'
regex_auto_homologacao='[01]'
regex_auto_sustentacao='[01]'
regex_auto_producao='[01]'

# Expressões inválidas

not_regex_rev='master|HEAD|origin/.*|refs/.*'
